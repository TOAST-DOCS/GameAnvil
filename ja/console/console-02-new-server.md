## Game > GameAnvil > コンソール利用ガイド > サーバー作成

## GameAnvilのメニューとタブ

GameAnvilコンソールは、上位のメニューで大きな機能が分かれており、各メニューは下位のタブで構成されています。例えば、**モニタリング**、**サーバー**、**Safe Pause**はメニューです。そしてモニタリングメニューは、**ダッシュボード**、**サーバー状況**、**ユーザー分布**、**オートスケールグループ**タブで構成されています。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/menu_1.png)

**サーバー**メニューは、**サーバー**、**オートスケールグループ**、**ノード**、**配布ファイル**、**Config**タブで構成されています。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/menu_2.png)

**Safe Pause**メニューは、**実行**、**履歴**タブで構成されています。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/menu_3.png)

このドキュメントは、このようなメニューとタブの機能を中心に説明します。


## サーバー作成のための準備

サーバーを作成するには、少なくともサーバーバイナリと関連設定及びデータなどが必要です。コンソールでは、このためにサーバーメニューの配布ファイルとConfigタブを提供します。 

配布ファイルタブにゲームサーバーバイナリをアップロードできます。アップロードしたバイナリは、以下の画面のように履歴が管理されます。サーバーを作成する際、このような配布ファイルの中から1つを選択し、各インスタンスに自動配布することになります。  
![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/deploy_file_list.png)

配布ファイルと同様に、サーバーを駆動するための構成情報(Config)を登録する必要があります。これにより、サーバーバイナリをどのような設定に基づいて駆動するかを決定できます。このような構成ファイルも、次の画面のようにその履歴が別途管理されます。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/config_list.png)

構成情報(Config)を登録する方式は大きく分けて二つあります。1つ目は、以下の画面のようにあらかじめ作成されたJSONファイルをアップロードする方式です。このとき、初めて構成情報(Config)ファイルを作成する場合、Configテンプレートダウンロードをクリックしてテンプレートをダウンロードし、使用できます。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/register_new_config_init.png)

二つ目は、以下の画面のように編集ウィンドウを利用して直接構成情報を入力する方式です。登録方式以外には違いがないため、お好みの方法を選択して構成情報を登録します。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/register_config.png)

登録した配布ファイルと構成ファイルは、リストだけでなく履歴タブでこれまでの全ての履歴を照会することもできます。


## サーバー作成

先の手順で配布ファイルとConfigファイルが正常に登録されていれば、サーバーを作成できます。サーバーは実際のサービスだけでなく、テストや開発など希望する用途で使用できます。

サーバーを作成するには、コンソールのサーバーメニューでサーバー作成をクリックしてください。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/empty_server_list.png)


以下のようにサーバー作成ページが表示されます。このドキュメントのサーバー基本情報、ノード構成の内容を参考にしてサーバーを作成してください。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/new_server_2.png)


## サーバー基本情報

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/create-03.png)

* サーバー名: 現在構成するサーバーを表す固有の識別子を指定します。同じ識別子を持つサーバーを複数台起動する場合は、その識別子の後ろに1から1ずつ増加する固有のナンバリングが追加されます。

* サーバー数量: 起動するサーバーの数量を設定します。 

* インスタンスタイプ: 作成するサーバーインスタンスのタイプを選択します。

* 配布ファイル: サーバーを起動するためにアップロードされたサーバーバイナリを選択します。選択する前に、必ず少なくとも1つ以上のサーバーバイナリがアップロードされている必要があります。配布ファイルタブでサーバーバイナリを管理できます。

* タグ: サーバー構成に対して任意のタグを作成しておくことができます。

* メモ: 該当サーバーに対する簡単なメモを作成できます。このメモはサーバー構成や運営に影響を与える値ではありません。

## ノード構成

GameAnvilのノードはゲームサーバーの機能単位です。開発が完了したサーバーバイナリは、ゲームで使用する全ての種類のノード実装を含んでいます。このようなバイナリで駆動されるサーバープロセスは設定により任意の選択されたノードのみで構成することができ、サーバー作成前に登録しておいた構成情報(Config)に基づいて設定します。つまり、構成情報(Config)にはノード構成情報が含まれています。複数の構成情報(Config)が登録されている場合、適用する構成をリストから選択できます。また、構成情報に含まれるノード設定をノードの種類ごとに有効化または無効化できます。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/new_server_node_config.png)


上記の画像は、次のように1つのゲートウェイノード、4つのゲームノード、2つのマッチノード、1つのサポートノードでサーバーを構成します。

| ノードの種類 | サービス名     | 駆動数 | 説明                                          |
|---------|---------------|-------|---------------------------------------------------|
| GATEWAY | -             | 1     | クライアント接続と認証を処理するノード。                    |
| GAME | RPSGame | 4 | ゲームコンテンツが実装されたゲームノードであり、それぞれch1～ch4までのチャンネルを担当する。 |
| MATCH   | -             | 2     | マッチメイキングを実行                                   |
| Support | DB | 2 | 必要に応じて独立したサービスとして実装できるようサポート |
| Support | WEB | 2 | 必要に応じて独立したサービスとして実装できるようサポート |


このとき、構成情報(Config)に入力したサービス名は、サーバー開発で使用された情報と同一である必要があります。サーバー実装で使用された情報と異なる値を入力した場合、サーバーが正常に駆動しません。チャンネル値もまた、構成情報(Config)に設定しておいた値がそのまま表示されます。

サーバー作成と同時に自動的にサーバーを起動するには、チェックボックスをクリックしてチェックを入れます。デフォルト値(作成即時起動)を使用することを推奨します。

## 作成されたサーバーの確認
サーバーを構成した後に実行すると、設定した数量だけサーバーが作成されます。作成されたサーバーは**TRANSIT**状態で開始され、黄色で表示されます。サーバーが**RUNNING**状態になるまで、NHN Cloudインフラの状態により数分(1～60分以上)かかる場合があります。特にGameAnvilサービスが最初のサーバーを駆動する際には、基本インフラ設定を同時に行うため、少し長い時間がかかる場合があります。ユーザーはこの時間の間、他の種類のサーバーを追加で構成したり、他のメニューを使用したりできます。

サーバーが正常に駆動すると、画像のように**RUNNING**状態に変わります。このように作成されたサーバーをクリックすると、次のようにサーバー情報を確認できます。このとき、ユーザーはサーバー制御コマンドで該当サーバーを終了させて削除したり、再起動などができます。あるいは多重選択ボタンを通じて一度に複数のサーバーを同時に選択してコマンドを実行することもできます。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/server_list.png)

サーバーリストから任意の項目をクリックすると、サーバー詳細情報を確認できます。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2_1/new-server/server_details.png)

## 動的ログレベル設定

起動中のサーバーの詳細画面で**ログレベル設定**をクリックし、動的ログレベルを設定できます。変更されたログレベルは、サーバーが起動している間のみ適用され、logbackファイルには保存されません。サーバーを終了してから起動すると、logbackの設定に初期化されます。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2_1/new-server/dynamic_log_level.png)

## 作成されたノード情報の確認

作成されたサーバーを構成する全てのノード情報は、ノードタブで確認できます。

**状態**、**ノードタイプ**、**サーバータイプ**だけでなく、**ノードID**など、より詳細で明確な情報に基づいて任意のノード情報のみフィルタリングすることもできます。 
![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/node_list.png)

## ロードバランサー

GameAnvilサービスは、クライアントの接続を効率的に処理するためにロードバランサーを連動させます。GameAnvilのノードのうち、クライアントが接続できるポイントはゲートウェイノードとサポートノードです。そしてこれらは全て複数のインスタンスで構成される可能性があります。このとき、複数の接続ポイントは適切な負荷分散のためにロードバランサーと連動する必要があります。また、該当ロードバランサーは外部から接続可能なフローティングIPに接続する必要があります。

![図](https://static.toastoven.net/prod_gameanvil/images/console/v2/new-server/loadbalancer.png)

このような一連の過程はGameAnvilサービスで自動的に処理し、**ロードバランサー情報**をクリックして接続情報を確認できます。該当情報はクライアントの接続アドレス/ポートのペアなので、不用意に外部に伝達されないように注意する必要があります。
