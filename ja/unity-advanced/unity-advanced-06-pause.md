## Game > GameAnvil > Unity 応用開発ガイド > バックグラウンド接続切れ防止

## バックグラウンド接続切れ防止

サーバーとクライアントの接続状態を確認するため、サーバーは定期的にクライアントの状態をチェックするメッセージを送り、クライアントはこれに応答するメッセージを送ります。しかしモバイルデバイスでゲームがバックグラウンドに切り替わるとUnityアプリケーションが停止し、アプリケーションが停止するとゲームサーバーとパケットをやり取りできなくなります。この状態では接続状態を確認するためのメッセージもやり取りできなくなるため、結局サーバーとの接続が切れることになります。

### 接続確認機能の一時停止及び再開

接続状態を確認できずにサーバーとの接続が切れるのを防ぐためには、バックグラウンドに切り替わる前にサーバーへ接続確認のための機能の一時停止をリクエストする必要があります。
アプリケーションがバックグラウンドやフォアグラウンドに切り替わる時、UnityのMonoBehaviourにあるOnApplicationPause()コールバックが呼び出されます。バックグラウンドに切り替わる時にPauseClientStateCheck()を呼び出して接続確認機能を一時停止し、フォアグラウンドに切り替わる時はResumeClientStateCheck()を呼び出して接続確認機能を再開します。 

```c#
public class GameAnvilManager : MonoBehaviour
{
    ...
    
    private void OnApplicationPause(bool pause)
    {
        if (pause)
        {
            connector.PauseClientStateCheck(pauseClientStateCheckTime);
        }
        else
        {
            connector.ResumeClientStateCheck();
        }
    }
    
    ...
}
```

PauseClientStateCheck()は次のような1つのパラメータを持っています。

| タイプ    | 名前           | 説明                                         |
|---------|----------------|----------------------------------------------|
| int     | pauseTime      | 一時停止する時間。<br/>最小値 : 10秒、最大値 : 15分、単位ミリ秒 |

最小値より小さい値を入力しても自動的に最小値が適用され、最大値より大きい値を入力しても最大値に該当する時間が経過すれば自動的に接続確認機能が再開されます。
