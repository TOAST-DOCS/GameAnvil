## 재접속

게임중 다양한 이유로 서버와의 접속이 끊어질 수 있습니다. 접속이 끊어졌을 때 기존의 플레이를 이어서 할 수 있도록 재접속 기능을 지원합니다. 사용하는 API는 일반적인 접속 방법과 동일하지만 결과로 받아오는 정보에 차이가 있습니다. 

### 서버 접속

ConnectionAgent의 Connect 함수를 이용해 서버에 접속합니다. 일반적인 경우와 동일합니다. 

```c#
/// <param name="ip">ip address</param>
/// <param name="port">port</param>
/// <param name="onConnect">결과를 전달 받을 delegate</param>
connector.GetConnectionAgent().Connect(ip, port, (ConnectionAgent connectionAgent, ResultCodeConnect result) => {
    /// <param name="result">Connect의 결과</param>
    if (result == ResultCodeConnect.CONNECT_SUCCESS) {
		// 접속 성공
    } else {
	    // 접속 실패
    }
});
```

### 인증

ConnectionAgent의 Authenticate 함수를 이용해 인증절차를 진행합니다. 입력 값은 일반적인 경우와 동일합니다. 다만 인증의 결과로 받아오는 값 중 loginedUserInfoList에 이전에 플레이하던 유저정보가 포함되어 오게 됩니다. 

```c#
connector.GetConnectionAgent().Authenticate(deviceId, accountId, password, payload
         (ConnectionAgent connectionAgent, ResultCodeAuth result, List<ConnectionAgent.LoginedUserInfo> loginedUserInfoList, string message, Payload payload) => {
    if (result == ResultCodeAuth.AUTH_SUCCESS) {
		foreach(ConnectionAgent.LoginedUserInfo loginedUserInfo in loginedUserInfoList)
		{
			// 플레이 유저정보
		}
    } 
});
```



### 로그인

인증 결과로 받은 유저정보를 이용해 로그인을 진행합니다. 이때 userType이나 channelId등 이전 유저 정보와 동일한 값을 이용해 로그인을 해야합니다. 그렇지 않으면 로그인이 실패할 수 있습니다. 

```c#
UserAgent userAgent = Connector.GetUserAgent(loginedUserInfo.ServiceName, loginedUserInfo.SubId);
userAgent.Login(loginedUserInfo.UserType, loginedUserInfo.ChannelId, null,
                 (UserAgent agent, ResultCodeLogin result, UserAgent.LoginInfo loginInfo) => {
	if (result == ResultCodeLogin.LOGIN_SUCCESS) {
        if(loginInfo.IsRelogined){
            // 재접속
        }else{
            // 처음 접속
        }
	}
});
```

로그인 성공시 UserAgent.LoginInfo의 IsRelogined가 true이면 재접속 로그인에 성공한것 입니다. UserAgent.LoginInfo에 포함된 정보들을 바탕으로 재접속 처리를 하시면됩니다. 이때 제일 중요한 것이 재접속 시간동안 서버의 변경된 데이터를 클라이언트에 동기화하는것입니다. 이 동기화에 필요한 데이터를 UserAgent.LoginInfo의 Payload에 담아 처리할 수있습니다.  

재접속 로그인을 하게되면 서버에서는 BaseUser.onRelogin() 콜백이 호출되게 됩니다. 이때 동기화에 필요한 메시지를 정의하여 outPayload 파라메터에 추가하면 UserAgent.LoginInfo의 Payload로 받아서 처리할 수 있습니다. 

만약 IsRelogined가 false이면 시간이 지나 이전 유저 정보가 제거된 다음 로그인이 된 것입니다. 이경우에는 처음 로그인하는 절차를 수행하면 됩니다. 
